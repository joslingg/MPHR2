<style>
.preview-table-container {
  max-height: 60vh;
  overflow-y: auto;
  border: 1px solid #dee2e6;
  border-radius: 0.5rem;
}
.preview-table-container table thead th {
  position: sticky;
  top: 0;
  background: #f8f9fa;
  z-index: 2;
}
.preview-table-container tbody tr.valid-row { background-color: #eaf8f0; }
.preview-table-container tbody tr.invalid-row { background-color: #fbeaea; }
.preview-table-container tbody tr:hover { background-color: #f6faff; transition: background-color 0.2s; }
.preview-table-container thead th { background-color: #247efc !important; color: #fff !important; }
</style>

<div class="card shadow-sm p-3">
  <h5 class="mb-3">ğŸ“‹ Káº¿t quáº£ kiá»ƒm tra dá»¯ liá»‡u</h5>
  
  <div class="mb-3">
    <span class="badge bg-primary me-2">Tá»•ng: {{ total }}</span>
    <span class="badge bg-success me-2">âœ… Há»£p lá»‡: {{ valid_count }}</span>
    <span class="badge bg-danger">âŒ Lá»—i: {{ invalid_count }}</span>
  </div>

  <div class="preview-table-container">
    <table class="table table-bordered table-hover align-middle mb-0">
      <thead class="text-center">
        <tr>
          <th>MÃ£ NV</th>
          <th>Há» vÃ  tÃªn</th>
          <th>NÄƒm khÃ¡m</th>
          <th>NgÃ y khÃ¡m</th>
          <th>PhÃ¢n loáº¡i</th>
          <th>Káº¿t luáº­n</th>
          <th>ÄÃ£ tiÃªm</th>
          <th>TÃªn váº¯c-xin</th>
          <th>Ghi chÃº / Lá»—i</th>
        </tr>
      </thead>

      <tbody>
        {% for t in temps %}
        <tr class="{% if t.is_valid %}valid-row{% else %}invalid-row{% endif %}">
          <td class="text-center">{{ t.employee_code }}</td>

          <td>{{ t.employee_name|default:"â€”" }}</td>

          <td class="text-center">{{ t.year|default:"â€”" }}</td>

          <td class="text-center">
            {% if t.exam_date %}
              {{ t.exam_date|date:"d/m/Y" }}
            {% else %}
              â€”
            {% endif %}
          </td>

          <td class="text-center">
            {% if t.health_classification_name %}
              {{ t.health_classification_name }}
            {% else %}
              â€”
            {% endif %}
          </td>

          <td>{{ t.conclusion_text|default:"â€”" }}</td>

          <td class="text-center">
            {% if t.vaccinated %}âœ…{% else %}â€”{% endif %}
          </td>

          <td>{{ t.vaccine_name|default:"â€”" }}</td>

          <td>
            {% if t.is_valid %}
              <span class="text-success fw-bold">âœ“ Há»£p lá»‡</span>
            {% else %}
              <span class="text-danger fw-bold">âœ— {{ t.error_message }}</span>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <div class="mt-3 d-flex gap-3">
    {% if all_valid %}
      <button class="btn btn-success"
              onclick="submitHealthImport('{{ batch_id }}')">
        ğŸ’¾ LÆ°u vÃ o há»‡ thá»‘ng
      </button>
    {% else %}
      <button class="btn btn-success" disabled>ğŸ’¾ LÆ°u vÃ o há»‡ thá»‘ng</button>
      <small class="text-danger align-self-center">(Cáº§n táº¥t cáº£ dÃ²ng há»£p lá»‡)</small>
    {% endif %}

    <!-- NÃºt cancel KHÃ”NG dÃ¹ng onclick trong partial -->
    <button class="btn btn-outline-danger"
            data-action="cancel-import"
            data-batch="{{ batch_id }}">
        âŒ Huá»· import
    </button>
  </div>
</div>
